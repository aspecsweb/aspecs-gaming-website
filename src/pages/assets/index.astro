---
import Layout from "@/layouts/Layout.astro";
import Section from "@/components/Section.astro";
import Container from "@/components/Container.astro";
import Heading from "@/components/Heading.astro";
import WidgetSearch from "@/components/WidgetSearch.astro";
import Assets from "@/components/Assets.astro";
---

<Layout title="Asset Store | Aspecs Gaming">
  <main class="bg-white">
    <!-- Header Section -->
    <Section class="relative bg-charcoal-900 pt-32 pb-24 overflow-hidden">
      <div
        class="absolute inset-0 opacity-20 bg-[linear-gradient(to_right,#ffffff05_1px,transparent_1px),linear-gradient(to_bottom,#ffffff05_1px,transparent_1px)] bg-[size:40px_40px]"
      >
      </div>

      <Container class="relative z-10 text-center">
        <Heading class="prose-invert">
          <h1
            slot="heading-title"
            class="text-white text-5xl md:text-8xl font-black tracking-tighter mb-4 leading-[0.9]"
          >
            Asset <span
              class="inline-block text-transparent bg-clip-text bg-gradient-to-r from-tomato-500 to-negroni-400 italic pr-4"
              >Store</span
            >
          </h1>
          <p
            slot="heading-content"
            class="text-negroni-200/60 text-lg max-w-xl"
          >
            Modular kits and stylized environments optimized for modern game
            engines. Ready for production.
          </p>
        </Heading>
      </Container>
    </Section>

    <!-- Sticky Search & Filters -->
    <Container class="relative z-30">
      <WidgetSearch />
    </Container>

    <!-- Assets Grid Section -->
    <Section>
      <Container>
        <Assets />
      </Container>
    </Section>
  </main>

  <script>
    document.addEventListener("astro:page-load", () => {
      const searchInput = document.getElementById("search") as HTMLInputElement;
      const priceSelect = document.getElementById("price") as HTMLSelectElement;
      const sortSelect = document.getElementById(
        "sortType",
      ) as HTMLSelectElement;
      const resetBtn = document.getElementById("reset-filters");
      const grid = document.getElementById("assets-grid");

      if (!grid) return;

      const applyFilters = () => {
        const figures = Array.from(grid.querySelectorAll("figure"));
        const searchVal = searchInput.value.toLowerCase();
        const priceVal = priceSelect.value;
        const sortVal = sortSelect.value;

        figures.forEach((f) => {
          const el = f as HTMLElement;
          const title =
            el.querySelector("h3")?.textContent?.toLowerCase() || "";
          const isFree = el.dataset.free === "true";

          const matchesSearch = !searchVal || title.includes(searchVal);
          const matchesPrice =
            !priceVal || (priceVal === "free" ? isFree : !isFree);

          el.style.display = matchesSearch && matchesPrice ? "block" : "none";
        });

        const sorted = figures.sort((a, b) => {
          const valA = Number((a as HTMLElement).dataset[sortVal]);
          const valB = Number((b as HTMLElement).dataset[sortVal]);
          return valB - valA;
        });

        sorted.forEach((f) => grid.appendChild(f));
      };

      searchInput?.addEventListener("input", applyFilters);
      priceSelect?.addEventListener("change", applyFilters);
      sortSelect?.addEventListener("change", applyFilters);
      resetBtn?.addEventListener("click", () => {
        searchInput.value = "";
        priceSelect.value = "";
        sortSelect.value = "published";
        applyFilters();
      });
    });
  </script>
</Layout>
